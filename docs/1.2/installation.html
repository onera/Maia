

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Installation &mdash; Maia  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/read_the_docs_custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/read_the_docs_custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introduction" href="introduction/introduction.html" />
    <link rel="prev" title="Quick start" href="quick_start.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Maia
          

          
          </a>

          
            
            
              <div class="version">
                v1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prefered-installation-procedure">Prefered installation procedure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-through-spack">Installation through Spack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#development-workflow">Development workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-the-build-folder">Source the build folder</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#development-workflow-with-submodules">Development workflow with submodules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#manual-installation-procedure">Manual installation procedure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#other-dependencies">Other dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-dependencies">Optional dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-install">Build and install</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_manual/user_manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_manual/developer_manual.html">Developer Manual</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="releases/release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_projects.html">Related projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Maia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<span id="id1"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prefered-installation-procedure">
<h2>Prefered installation procedure<a class="headerlink" href="#prefered-installation-procedure" title="Permalink to this headline">¶</a></h2>
<p>Maia depends on quite a few libraries of different kinds, be it system libraries like MPI, third-party libraries like HDF5, ONERA libraries like ParaDiGM and Cassiopée, git submodules (std_e…), or Python modules (mpi4py, ruamel). The prefered way of installing Maia in a coherent environment is by using the <a class="reference external" href="https://spack.readthedocs.io/">Spack package manager</a>. A Spack recipe for Maia can be found on the <a class="reference external" href="https://gitlab.onera.net/informatics/infra/onera_spack_repo">ONERA Spack repository</a>.</p>
<div class="section" id="installation-through-spack">
<h3>Installation through Spack<a class="headerlink" href="#installation-through-spack" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Source a Spack repository on your machine.</p></li>
<li><p>If you don’t have a Spack repository ready, you can download one with <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/spack/spack.git</span></code>. On ONERA machines, it is advised to use the <a class="reference external" href="https://gitlab.onera.net/informatics/infra/spacky">Spacky</a> helper.</p></li>
<li><p>Download the <strong>ONERA Spack repository</strong> with <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://gitlab.onera.net/informatics/infra/onera_spack_repo.git</span></code></p></li>
<li><p>Tell Spack that package recipes are in <code class="code docutils literal notranslate"><span class="pre">onera_spack_repo</span></code> by adding the following lines to <code class="code docutils literal notranslate"><span class="pre">$SPACK_ROOT/etc/repos.yaml</span></code>:</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">repos</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path/to/onera_spack_repo</span>
</pre></div>
</div>
<p>(note that <strong>spacky</strong> does steps 3. and 4. for you)</p>
<ol class="arabic simple" start="5">
<li><p>You should be able to see the package options of Maia with <code class="code docutils literal notranslate"><span class="pre">spack</span> <span class="pre">info</span> <span class="pre">maia</span></code></p></li>
<li><p>To install Maia: <code class="code docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span> <span class="pre">maia</span></code></p></li>
</ol>
</div>
<div class="section" id="development-workflow">
<h3>Development workflow<a class="headerlink" href="#development-workflow" title="Permalink to this headline">¶</a></h3>
<p>For development, it is advised to use Spack to have Maia dependencies, but then follow a typical CMake workflow with <code class="code docutils literal notranslate"><span class="pre">cmake/make</span></code>.</p>
<div class="section" id="dependencies">
<h4>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h4>
<p>To get access to Maia dependencies in your development environment, you can:</p>
<ul class="simple">
<li><p>Install a Spack version of Maia, source it in your development environment to get all the dependencies, then override with your own compiled version of Maia</p></li>
<li><p>Do the same, but use a Spack environment containing Maia instead of just the Maia package</p></li>
<li><p>Source a Spack environment where Maia has been removed from the environment view. This can be done by adding the following lines to the <code class="code docutils literal notranslate"><span class="pre">spack.yaml</span></code> environement file:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">view</span><span class="p">:</span>
  <span class="nt">default</span><span class="p">:</span>
    <span class="nt">exclude</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;maia&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>This last option is cleaner because you are sure that you are not using another version of Maia (but it means you need to create or have access to such an environment view)</p>
</div>
<div class="section" id="source-the-build-folder">
<h4>Source the build folder<a class="headerlink" href="#source-the-build-folder" title="Permalink to this headline">¶</a></h4>
<p>You can develop without the need to install Maia. However, in addition to sourcing your dependencies in your development environment, you also need to source the build artifacts by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$MAIA_BUILD_FOLDER</span>
<span class="nb">source</span> source.sh
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">source.sh</span></code> file is created by CMake and will source all Maia artifacts (dynamic libraries, python modules…)</p>
</div>
</div>
<div class="section" id="development-workflow-with-submodules">
<h3>Development workflow with submodules<a class="headerlink" href="#development-workflow-with-submodules" title="Permalink to this headline">¶</a></h3>
<p>It is often practical to develop Maia with some of its dependencies, namely:</p>
<ul class="simple">
<li><p>project_utils</p></li>
<li><p>std_e</p></li>
<li><p>cpp_cgns</p></li>
<li><p>paradigm</p></li>
<li><p>pytest_parallel</p></li>
</ul>
<p>For that, you need to use git submodules. Maia submodules are located at <code class="code docutils literal notranslate"><span class="pre">$MAIA_FOLDER/external</span></code>. To populate them, use <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--init</span></code>. Once done, CMake will use these versions of the dependencies. If you don’t populate the submodules, CMake will try to use the ones of your environment (for instance, the one installed by Spack).</p>
<p>We advise that you use some additional submodule configuration utilities provided in <a class="reference external" href="https://github.com/BerengerBerthoul/project_utils/blob/master/git/submodule_utils.sh">this file</a>. In particular, you should use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$MAIA_FOLDER</span>
git submodule update --init
git_config_submodules
</pre></div>
</div>
<p>The detailed meaning of <cite>git_config_submodules</cite> and the git submodule developper workflow of Maia is presented <a class="reference external" href="https://github.com/BerengerBerthoul/project_utils/blob/master/doc/Git_workflow.md">here</a>.</p>
<p>If you are using Maia submodules, you can filter them out from your Spack environment view like so:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">view</span><span class="p">:</span>
  <span class="nt">default</span><span class="p">:</span>
    <span class="nt">exclude</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;maia&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;std-e&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;cpp-cgns&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;paradigm&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;pytest_parallel&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="manual-installation-procedure">
<h2>Manual installation procedure<a class="headerlink" href="#manual-installation-procedure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Dependencies<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><strong>Maia</strong> depends on:</p>
<ul class="simple">
<li><p>python3</p></li>
<li><p>MPI</p></li>
<li><p>hdf5</p></li>
<li><p>Cassiopée</p></li>
<li><p>pytest &gt;6 (python package)</p></li>
<li><p>ruamel (python package)</p></li>
<li><p>mpi4py (python package)</p></li>
</ul>
<p>The build process requires:</p>
<ul class="simple">
<li><p>Cmake &gt;= 3.14</p></li>
<li><p>GCC &gt;= 8 (Clang and Intel should work but no CI)</p></li>
</ul>
<div class="section" id="other-dependencies">
<h4>Other dependencies<a class="headerlink" href="#other-dependencies" title="Permalink to this headline">¶</a></h4>
<p>During the build process, several other libraries will be downloaded:</p>
<ul class="simple">
<li><p>pybind11</p></li>
<li><p>range-v3</p></li>
<li><p>doctest</p></li>
<li><p>ParaDiGM</p></li>
<li><p>project_utils</p></li>
<li><p>std_e</p></li>
<li><p>cpp_cgns</p></li>
</ul>
<p>This process should be transparent.</p>
</div>
<div class="section" id="optional-dependencies">
<h4>Optional dependencies<a class="headerlink" href="#optional-dependencies" title="Permalink to this headline">¶</a></h4>
<p>The documentation build requires:</p>
<ul class="simple">
<li><p>Doxygen &gt;= 1.8.19</p></li>
<li><p>Breathe &gt;= 4.15 (python package)</p></li>
<li><p>Sphinx &gt;= 3.00 (python package)</p></li>
</ul>
</div>
</div>
<div class="section" id="build-and-install">
<h3>Build and install<a class="headerlink" href="#build-and-install" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Install the required dependencies. They must be in your environment (<code class="code docutils literal notranslate"><span class="pre">PATH</span></code>, <code class="code docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>, <code class="code docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>).</p></li>
</ol>
<blockquote>
<div><p>For pytest, you may need these lines :</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --user pytest
pip3 install --user pytest-mpi
pip3 install --user pytest-html
pip3 install --user pytest_check
pip3 install --user ruamel.yaml
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Then you need to populate your <code class="code docutils literal notranslate"><span class="pre">external</span></code> folder. You can do it with <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--init</span></code></p></li>
<li><p>Then use CMake to build maia, e.g.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SRC_DIR</span><span class="o">=</span>&lt;path to <span class="nb">source</span> repo&gt;
<span class="nv">BUILD_DIR</span><span class="o">=</span>&lt;path to tmp build dir&gt;
<span class="nv">INSTALL_DIR</span><span class="o">=</span>&lt;path to where you want to install Maia&gt;
cmake -S <span class="nv">$SRC_DIR</span> -B<span class="nv">$BUILD_DIR</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$INSTALL_DIR</span>
<span class="nb">cd</span> <span class="nv">$BUILD_DIR</span> <span class="o">&amp;&amp;</span> make -j <span class="o">&amp;&amp;</span> make install
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="introduction/introduction.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="quick_start.html" class="btn btn-neutral float-left" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ONERA The French Aerospace Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 1.2
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      
      <dl>
        <dt>Versions</dt>
        
        
          <dd><a href="/Maia/1.3/">1.3</a></dd>
        
          <dd><a href="/Maia/1.2/">1.2</a></dd>
        
          <dd><a href="/Maia/1.1/">1.1</a></dd>
        
          <dd><a href="/Maia/1.0/">1.0</a></dd>
        
      </dl>
      
      
      
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
 
    </div>
  </div>

 

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>